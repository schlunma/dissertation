%=============================================================================%
%                            Doctoral Dissertation                            %
%                               Manuel Schlund                                %
%                                  (c) 2021                                   %
%=============================================================================%
%                                  Paper GPP                                  %
%=============================================================================%



\chapter{Constraining Future Gross Primary Production with Machine Learning}
\label{ch:06:paper_gpp}

As argued in detail in the previous \namecref{ch:05:paper_ecs},
single-process-oriented emergent constraints do not seem to be beneficial in
constraining climate projections from the vastly complex modern-day \acp{ESM}
since they might overly simplify the problem. To overcome this issue, we
explore an alternative approach that expands the \acf{MDER} method (see
\cref{subsec:02:mder}) with a supervised \acf{ML} algorithm. In contrast to
emergent constraints, this approach considers (1) multiple process-based
predictors, (2) multi-dimensional (gridded) target variables and (3) non-linear
relationships between the predictors and the target variable. Since the new
technique relies on a large number of data points in order to train the \ac{ML}
algorithm, \ac{ECS} as a single scalar metric for each climate model is not an
appropriate target variable. As an alternative, we analyze projections of
future \acf{GPP} in this study, which constitutes the largest flux of the
terrestrial carbon uptake. As described in detail in
\cref{subsec:02:carbon_cycle_perturbations}, the global carbon cycle actively
slows down global warming by removing \ac{CO2} from the atmosphere. In
particular, the terrestrial biosphere absorbs about $30 \unit{\%}$ of the total
anthropogenic \ac{CO2} emission \autocite{Friedlingstein2020}. Thus, accurately
quantifying the future evolution of the terrestrial carbon sink is crucial for
reliable climate change projections.

Due to complex feedback processes connected to the global carbon cycle
(concentration-carbon feedback and climate-carbon feedback; see
\cref{subsec:02:carbon_cycle_perturbations}), the response of the terrestrial
carbon cycle to changes in the atmospheric \ac{CO2} concentration and climate
is a major source of uncertainty in climate projections \autocite{Bodman2013,
  Booth2012, Collins2013}. This applies for example to multi-model projections
of future \ac{GPP} of the \acs{CMIP}5 ensemble. Thus, the aim of this study is
to reduce uncertainties in multi-model projections of future \ac{GPP} in the
\acs{CMIP}5 \acs{RCP}8.5 scenario at the end of the \nth{21} century with a new
\ac{ML}-based weighting technique and appropriate observations. The new
two-step approach utilizes aspects of emergent constraints and the \ac{MDER}
technique in combination with a \ac{ML} algorithm. In the first step, we apply
an existing emergent constraint on \ac{CO2} fertilization \autocite{Wenzel2016}
to constrain the \acp{ESM}' responses to rising atmospheric \ac{CO2}
concentration using observations of the increase of the \ac{CO2} seasonal cycle
amplitude at \ac{KUM} \autocite{Keeling2005}. In a second step, we introduce a
supervised \ac{ML} algorithm based on boosting trees \autocite{Friedman2001} to
learn an empirical spatial relationship that links grid-wise future \ac{GPP} to
historical processes relevant to its simulation under present-day conditions.
In combination with observational products of the predictors, that relationship
can be used to further constrain uncertainties in the projected spatial maps of
\ac{GPP} at the end of the \nth{21} century in the \acs{RCP}8.5 scenario. We
examine both constraining the absolute \ac{GPP} and the fractional change in
\ac{GPP} as two independent approaches and target variables. Unlike univariate
linear regression used in the \ac{MDER} algorithm, the proposed
\emph{\ac{GBRT}} algorithm is able to handle multiple predictors and copes with
non-linearities in the data. \ac{GBRT} is a well-known and successful tool used
for interpolation, classification and prediction in other fields of data
science and engineering \autocite{Death2007, Elith2008}. In the context of
climate science, \ac{GBRT} was recently applied to identify the key drivers of
spatial variations of the ratio of plant transpiration to total terrestrial
evapotranspiration in \acp{ESM} \autocite{Lian2018}.

This work is already published in \textcite{Schlund2020}. For this paper, the
author of this thesis lead the writing and the analysis and implemented the
code to reproduce this study with all figures and tables using the
\ac{ESMValTool}. \Cref{sec:06:data_and_methods} of this
\namecref{ch:06:paper_gpp} provides an overview of the data and methods used in
this paper. The results are presented in \cref{sec:06:results} and
\cref{sec:06:summary_and_discussion} closes with a summary and discussion.


\section{Data and Methods}
\label{sec:06:data_and_methods}

Here we briefly describe the data and methods used in this study.
\Cref{subsec:06:step_1} reviews the method of a previously published emergent
constraint on \ac{CO2} fertilization from \textcite{Wenzel2016} that we apply
here to our study to rescale the climate model output (step 1). This includes a
discussion of the caveats that are associated with this emergent constraint
that attributes changes in the observed increase in the \ac{CO2} seasonal cycle
amplitude at \ac{KUM} entirely to the increase in atmospheric \ac{CO2}
concentration, yet other studies provide indications that part of this increase
is due to climate and land use changes \autocite{Bastos2019, Forkel2016,
  Piao2018, Zhao2016}. In \cref{subsec:06:step_2} the \ac{ML} technique used in
step 2 to constrain gridded \ac{GPP} projections is presented.
\Cref{fig:06:schematic_steps} shows an overview of our two-step approach.
\Cref{subsec:06:uncertainty_and_skill} describes how uncertainty and predictive
skill are quantified. A complete list of all \acs{CMIP}5 models used in this
study is given in \cref{tab:app:b:cmip5_models}. To apply the emergent
constraint in step 1, we need emission-driven \acs{CMIP}5 simulations. The
number of \acp{ESM} included is therefore seven, as in \textcite{Wenzel2016}.
More details on the methods and the experimental setup are given in
\cref{sec:app:si_for_paper_gpp}.

\begin{figure}[t]
  \centering
  \includegraphics[width=\LargeFigureWidth{}]{ch06_paper_gpp/figs/1.pdf}
  \caption[
    Schematic illustration of our two-step approach.
  ]{
    Schematic illustration of our two-step approach. In step 1 an emergent
    constraint by \textcite{Wenzel2016} is used to constrain the global mean
    fractional change in \acf{GPP} over the \nth{21} century. Moreover, this
    constraint is used to rescale two different gridded target variables:
    absolute \acs{GPP} at the end of the \nth{21} century and fractional
    \acs{GPP} change over the \nth{21} century. In step 2, a \acl{ML} model is
    used to constrain these two target variables (step 2a: absolute \acs{GPP};
    step 2b: fractional \acs{GPP} change) in two independent approaches.
    \AdaptedFrom{Schlund2020}.
  }
  \label{fig:06:schematic_steps}
\end{figure}


\subsection{Constraining the \texorpdfstring{\acs{CO2}}{CO2} Fertilization
  Effect (Step 1)}
\label{subsec:06:step_1}

In this \namecref{subsec:06:step_1}, we present the observational emergent
constraint on the \ac{CO2} fertilization effect by \textcite{Wenzel2016} which
we use to globally rescale the models for their individual bias in the
sensitivity of \ac{GPP} to an increase in atmospheric \ac{CO2} concentration.
Our objective here is to present a general methodology and suggest further
improvements upon this constraint that could be used in the future.
\textcite{Wenzel2016} show a correlation between the increase in the \ac{CO2}
seasonal cycle amplitude simulated by models and the projected \ac{CO2}
fertilization. When combined with the observed trends in the \ac{CO2} seasonal
cycle amplitude, the fractional \ac{GPP} change at the time of \ac{CO2}
doubling relative to pre-industrial conditions in a \ac{1BGC} is constrained.
The predictor in this study is the sensitivity of the \ac{CO2} seasonal cycle
amplitude to rising atmospheric \ac{CO2} concentrations, defined as the slope
of the linear regression between the \ac{CO2} seasonal cycle amplitude and the
annual mean atmospheric \ac{CO2} concentrations (see \cref{fig:app:b:co2} for
details). The emergent constraint is physically motivated by the hypothesis
that increasing terrestrial \ac{GPP} is a main driver for the observed changes
in the \ac{CO2} seasonal cycle amplitude \autocite{Gray2014, Keeling1996,
  Zhao2014}. This hypothesis is based on the fact that the seasonal cycle in
atmospheric \ac{CO2} concentration originates from photosynthesis and
decomposition processes: in summer, photosynthesis removes \ac{CO2} from the
atmosphere; in winter, additional \ac{CO2} is added to the atmosphere due to
the decomposition of organic matter \autocite{Keeling1995}. Thus, \ac{CO2}
fertilization leads to an increase of the \acs{CO2} seasonal cycle amplitude
due to increased \acs{CO2} removal from the atmosphere. We note that this
emergent constraint implicitly assumes that there is no temperature-driven
increase in respiration over time. Therefore, this approach most likely
overestimates the true sensitivity of \ac{GPP} to an increase in the
atmospheric \ac{CO2} concentration.

However, we note that this emergent constraint is not undisputed. In other
studies, the observed change in the \ac{CO2} seasonal cycle amplitude is
attributed to other factors. Using a dynamic global vegetation model,
\textcite{Forkel2016} find that the increase in the \ac{CO2} seasonal cycle
amplitude above $40 \unit{\degree N}$ is mainly driven by the response of
plants to global warming instead of \ac{CO2}. Similarly, \textcite{Piao2018}
show that elevated atmospheric \acs{CO2} concentration and climate change
equally contribute to the increase in the \ac{CO2} seasonal cycle in northern
high latitudes with additional smaller contributions from air-sea carbon fluxes
and land use changes. For their analysis, \textcite{Piao2018} use \ac{CO2}
records from 26 stations and nine terrestrial ecosystem models. An evaluation
of two atmospheric inversions and eleven land surface models shows contrasting
effects of \ac{CO2} fertilization (positive) and global warming (negative) on
the \ac{CO2} seasonal cycle amplitude increase in northern high latitudes with
negligible contributions from land use changes \autocite{Bastos2019}. A further
study by \textcite{Zhao2016} finds that for seven out of nine dynamic
vegetation models, the \ac{CO2} fertilization effect is the strongest driver
for the observed changes in the \ac{CO2} seasonal cycle amplitude, while the
two remaining models equally attribute this to \ac{CO2} fertilization, climate
change and land use changes. Moreover, \textcite{Winkler2019a} discuss
limitations of carbon cycle emergent constraints related to the calculation of
the predictor from observation-based data and the inter-model relationship. As
a case study, they adopt a further emergent constraint by
\textcite{Winkler2019} that uses the response of the \ac{LAI} to ambient
\ac{CO2} instead of the \ac{CO2} seasonal cycle amplitude sensitivity to
constrain the \ac{GPP} increase in the northern high latitudes. Furthermore, it
has been shown that the \acs{CMIP}5 models \autocite{Graven2013} and the TRENDY
dynamic vegetation models \autocite{Thomas2016} greatly underestimate long-term
changes in the \ac{CO2} seasonal cycle which questions their ability to
attribute changes in the \ac{CO2} seasonal cycle to different contributors.
Nevertheless, we emphasize that we here present a generic methodology and use
the results of an existing emergent constraint. Our proposed framework is
universal and could be based on other emergent constraints in the future.

In contrast to \textcite{Wenzel2016}, instead of idealized simulations we apply
the presented emergent constraint on the emission-driven \acs{RCP}8.5
simulation \autocite{Riahi2011} and examine whether it still holds for this
simulation where forcings other than \ac{CO2} also change. Moreover, we
consider the global mean \ac{GPP} change instead of the \ac{GPP} change in the
northern extratropics as in \textcite{Wenzel2016}. Due to the strong annual
mixing of \ac{CO2} in the atmosphere, the change in the \ac{CO2} seasonal cycle
amplitude at \ac{KUM} is representative for the whole globe. Thus, we apply
this emergent constraint to the global mean \ac{GPP} change. However, we note
that this approach might introduce errors since the \ac{CO2} fertilization
effect could be different for tropical and extratropical ecosystems due to
nutrient limitations and the temperature dependence of Rubisco kinetics
\autocite{CraftsBrandner2000} in the tropics. Nevertheless, we argue that we
can use the constraint if the emergent relationship still holds within our
considered framework (the \acs{RCP}8.5 scenario simulated by the \acs{CMIP}5
models).

Therefore, our target variable in step 1 is the global mean fractional
\acs{GPP} change over the \nth{21} century $f$ in the \acs{RCP}8.5 scenario,
which is calculated from the 10-year mean \ac{GPP} at the end of the \nth{21}
century in the emission‐driven fully-coupled \acs{RCP}8.5 simulations
(\range{2091}{2100}) and the 10-year mean \ac{GPP} at the end of the \nth{20}
century (\range{1991}{2000}) in the emission-driven historical simulation:
\begin{equation}
  f = \frac{\mathtxt{GPP (\range{2091}{2100})}}{
    \mathtxt{GPP (\range{1991}{2000})}} - 1.
  \label{eq:06:f}
\end{equation}
This variable is given as a percentage, where negative values correspond to a
decrease in \ac{GPP}, positive values to an increase in \ac{GPP} and a value of
$0 \unit{\%}$ to no \ac{GPP} change. The \ac{CO2} amplitude sensitivity is
calculated for the years \range{1979}{2019}, which is the full available time
range for the observed \ac{CO2} record at \ac{KUM} \autocite{Keeling2005}.
Similar \textcite{Wenzel2016}, we extract the observed \ac{CO2} amplitude from
smoothed atmospheric \ac{CO2} concentrations (using a stiff cubic spline
function plus a four-harmonics functions with linear gain) as provided by
\textcite{Keeling2005}. For the \acs{CMIP}5 models, the respective grid cell
closest to \ac{KUM} ($19.5 \unit{\degree N}$, $154.8 \unit{\degree W}$) is
extracted. Additionally, the emission-driven historical simulations are
extended with the emission-driven \acs{RCP}8.5 simulations for the years 2006
to 2019. More details including an illustration of this calculation are shown
in \cref{fig:app:b:co2}.

Since the global constraint above cannot be used directly as a predictor in the
\ac{ML} approach which operates on gridded values (see
\cref{subsec:06:step_2}), we use it as first step to globally rescale the
\ac{ESM} output. This important first step allows us to constrain the large
uncertainty in the global \ac{CO2} fertilization effect of the \acs{CMIP}5
models. In this study, two different gridded target variables are examined (see
\cref{fig:06:schematic_steps}): the monthly climatology of future absolute
\ac{GPP} at the end of the \nth{21} century (\range{2091}{2100}) in the
\acs{RCP}8.5 scenario (see step 2a) and the fractional \acs{GPP} change over
the \nth{21} century as defined in \cref{eq:06:f} (see step 2b). The global
rescaling of the gridded target variables works as follows: Let $f_m$ be the
global mean fractional \acs{GPP} change over the \nth{21} century of \ac{ESM}
$m$, $f'$ the constrained value of the global mean fractional \ac{GPP} change
and $y_{mi}$ the target variable of climate model $m$. Then, we define the
rescaled target variable $y'_{mi}$ by
\begin{equation}
  y'_{mi} = y_{mi} \cdot \frac{f'}{f_m},
  \label{eq:06:y}
\end{equation}
where the index $i$ counts over all grid cells (and months when absolute
\ac{GPP} is used as target variable in step 2a) and $m$ refers to the \ac{ESM}
($m \in \left\{ 1, 2, \ldots, 7 \right\}$). Thus, values for the individual
grid cells/months are rescaled by a factor that is determined by the ratio
between the models' global mean \ac{GPP} change and the constrained global mean
\ac{GPP} change derived from the \textcite{Wenzel2016} emergent constraint
using the observed change in the \ac{CO2} cycle amplitude. Models that simulate
a too high global mean \ac{GPP} change are nudged toward smaller values and
vice versa. The rescaled target variables are then fed into the \ac{ML} model
(step 2) presented in the following \namecref{subsec:06:step_2}. We note that
this global rescaling assumes that the relative biases in the fractional
\ac{GPP} change of the individual \acp{ESM} are constant over the whole globe.


\subsection{Gradient Boosted Regression Tree (\acs{GBRT}) Algorithm (Step 2)}
\label{subsec:06:step_2}

For step 2 we use the \ac{GBRT} algorithm to find an optimal regression
function $F$ relating the target variable $y$ to a set of $K$ predictors
$\bm{x} = \left( x^{(1)}, x^{(2)}, \ldots, x^{(K)} \right)$ (also called
\emph{features} or \emph{covariates}) such that the predicted target variable
is given by $\hat{y} = F(\bm{x})$ \autocite{Death2007, Elith2008, Friedman2001,
  Friedman2002}. Its basic elements are decision trees, which use binary splits
of the input data to create decision rules. Due to their simple nature,
decision trees are easy to interpret but cannot be used to create satisfying
predictions for very complex datasets. This issue can be overcome by a
technique called \emph{boosting} \autocite{Freund1996}. Boosting iteratively
improves the performance of \emph{weak learners} (in our case decision trees)
in the following way: At first, a single decision tree is fitted to a randomly
selected subsample of the training data $\left\{ \left( \bm{x}_i, y_i \right)
\mid i \in I \right\}$ with an arbitrary index set $I$ (using a predefined loss
function, \eg{} the mean square error). Then, further decision trees are
linearly added to the regression function $F$ (scaled by a regularization
parameter $\nu \ll 1$ called \emph{learning rate}) and the model is fitted
again in the same manner. This ensures that the prediction for poorly modeled
training points in the beginning will gradually improve during the training.
The whole procedure is repeated until the loss function does not improve
anymore, as evaluated on an independent validation data set. Relevant
hyperparameters of this algorithm (maximum number of decision trees, maximum
depth of the decision trees, learning rate and the subsample ratio) are
optimized by $5$-fold \acf{CV} using the training data. More details on the
\ac{GBRT} algorithm are given in \cref{subsec:app:b:gbrt}.

A convenient way to evaluate and interpret \ac{GBRT} models (or other
statistical models in general) is to identify the most relevant predictors.
Globally, this so-called \emph{feature importance} is closely related to the
number of appearances of a predictor in the different decision trees that set
up the \ac{GBRT} model \autocite{Friedman2001}. To evaluate the feature
importance regionally (for the different grid cells), we use a model
distillation technique called \emph{\ac{LIME}}, which approximates the
\ac{GBRT} model with a local linear regression model for each grid cell
\autocite{Ribeiro2016}. The corresponding linear coefficients $b_k$ for each
predictor $x^{(k)}$ constitute a good proxy to the model's Jacobian
\begin{equation}
  b_k \approx \frac{\partial y}{\partial x^{(k)}},
  \label{eq:06:jacobian}
\end{equation}
which is difficult to compute explicitly for this particular \ac{ML} model.
Thus, features with high (low) absolute $b_k$ have a high (low) impact on the
local prediction of the target variable $y$.

\begin{figure}[p]
  \centering
  \includegraphics[width=\LargerFigureWidth{}]{ch06_paper_gpp/figs/2.pdf}
  \caption[
    Schematic illustration of our \acl{ML} approach to constrain projected
    absolute \acf{GPP} at the end of the \nth{21} century in step 2a.
  ]{
    Schematic illustration of our \acf{ML} approach to constrain projected
    absolute \acf{GPP} in step 2a. (a) In the training phase of the algorithm,
    the model is fitted to the training data interpolating the empirical
    (non-linear) relationship between two process-oriented diagnostics of the
    past climate $\left\{ x^{(1)}, x^{(2)} \right\}$ and (rescaled) future
    \acs{GPP} (gray surface). The points show the training points for the
    supervised \acs{ML} algorithm, each of them representing a single grid
    cell/month of a single climate model (the different colors correspond to
    different climate models). (b) In the prediction phase, observation-based
    values of the diagnostic (black points) are fed into the trained \acs{ML}
    model to constrain \acs{GPP} for every grid cell/month to a value which
    best agrees with the observations. (c) For an independent validation of our
    method, we use an out-of-sample testing setup based on a
    leave-one-model-out \acl{CV} approach (see \cref{subsec:02:model_weighting}
    for details). The schematic illustration of step 2b differs only in the
    target variable used (fractional \acs{GPP} change instead of absolute
    \acs{GPP}). \AdaptedFrom{Schlund2020}.
  }
  \label{fig:06:mlr_concept}
\end{figure}

\begin{table}[t]
  \centering
  \begin{tabular}[t]{p{0.27\columnwidth} l p{0.11\columnwidth}
      p{0.3\columnwidth}}
    \toprule
    Predictor & \makecell{Observation‐driven \\ data} & Used time range &
    Physical connection to \acs{GPP} \\
    \midrule
    \predictor{GPP} & \makecell{FLUXNET-MTE \\ \autocite{Jung2011}} &
    \range{1991}{2000} & -- \\
    \midrule
    \predictor{LAI} & \makecell{LAI3g \\ \autocite{Zhu2013}} &
    \range{1982}{2005} & \acs{LAI} is a measure for the number of leaves in a
    grid cell. The photosynthesis rate is highly dependent on the number of
    leaves (and vegetation in general). \\
    \midrule
    \predictor{PR} & \makecell{CRU \\ \autocite{Harris2014}} &
    \range{1901}{2005} & Water is essential for the chemical processes of
    photosynthesis. \\
    \midrule
    \predictor{RSDS} & \makecell{ERA-Interim \\ \autocite{Dee2011}} &
    \range{1979}{2005} & Solar radiation is essential for the chemical
    processes of photosynthesis. \\
    \midrule
    \predictor{T} & \makecell{CRU \\ \autocite{Harris2014}} &
    \range{1901}{2005} & \acs{T} and photosynthesis rate have a common driver
    (incoming solar radiation). \\
    \bottomrule
  \end{tabular}
  \caption[
    Process-oriented diagnostics used in the \acf{GBRT} model to predict the
    target variables.
  ]{
    Process-oriented diagnostics (also called \emph{predictors} or
    \emph{features}) used in the \acf{GBRT} model to predict the target
    variables. For step 2a (target variable: absolute \acs{GPP}), all listed
    variables are monthly climatologies of the specified time ranges in the
    historical climate. For step 2b (target variable: fractional \acs{GPP}
    change), the temporal mean over the specified time ranges is calculated for
    all variables. \AdaptedFrom{Schlund2020}.
  }
  \label{tab:06:predictors}
\end{table}

As already described in the previous \namecref{subsec:06:step_1}, we analyze
two different target variables in this study: the monthly climatology of
absolute \ac{GPP} at the end of the \nth{21} century (step 2a) and the
fractional \ac{GPP} change over the \nth{21} century (step 2b). A schematic
representation of step 2a is shown in \cref{fig:06:mlr_concept}. The target
variable $y$ for the \ac{ML} model is the rescaled monthly climatology of
future GPP at the end of the \nth{21} century (\range{2091}{2100}) in the
\acs{RCP}8.5 scenario given by \cref{eq:06:y}. We relate this target variable
to several process-oriented diagnostics $\bm{x}$ of the past climate
(historical simulation) listed in \cref{tab:06:predictors}. A single training
point $\left( \bm{x}_i, y_i \right)$ for the supervised \ac{ML} algorithm
corresponds to the set of the aforementioned diagnostics evaluated on a single
grid cell/month of a single climate model (see colored points in
\namecrefs{fig:06:mlr_concept} \labelcref{fig:06:mlr_concept}{\color{BrownRed}
  a} and \labelcref{fig:06:mlr_concept}{\color{BrownRed} b}). Step 2b differs
from step 2a only in the target variable used. Both steps are independent
approaches and are evaluated separately.

The main part of steps 2a and 2b each consist of two phases. In the first phase
(training of the algorithm), we build a statistical model based on the
empirical relationship between observable process-oriented variables of the
present-day climate and future \ac{GPP} in the \acs{CMIP}5 ensemble (see gray
surface in \namecrefs{fig:06:mlr_concept}
\labelcref{fig:06:mlr_concept}{\color{BrownRed} a} and
\labelcref{fig:06:mlr_concept}{\color{BrownRed} b}). This has a flavor similar
to the \ac{MDER} algorithm \commentcite{Karpechko2013, Senftleben2020,
  Wenzel2016a}{see \cref{subsec:02:mder}}. However, in contrast to the original
\ac{MDER} algorithm, our multivariate \ac{GBRT} approach is able to handle
multiple predictors with non-linear dependencies. Moreover, instead of
considering a single globally or regionally averaged value per climate model,
our approach uses spatiotemporally gridded data for every \ac{ESM} in the
ensemble. This dramatically increases the available number of training data
(even if they are not statistically independent) and uniquely enables the
statistical model to identify and exploit regional processes. Furthermore, the
large training database allows us to perform extensive out-of-sample testing,
which is crucial to ensure the \ac{ML} model's robustness.

In the second phase (predicting with the trained \ac{GBRT} model), we use
observational data products to constrain the \acs{RCP}8.5 \acs{CMIP}5
projection of \ac{GPP}. To do this, observational data for all predictors
$\bm{x}$ of the historical climate (for every grid cell/month) are fed into the
trained \ac{GBRT} model in order to get a spatially constrained projection of
\ac{GPP} (see black points in \cref{fig:06:mlr_concept}{\color{BrownRed} b}).
Similar to the \ac{MDER} algorithm, our approach assumes that there exists an
inter-model relationship between the predictors and the target variable which
also holds for the true climate. This assumption may seem weak at first glance,
but compared to the assumption of traditional weighting approaches (models that
are better in simulating the present-day climate are also better in simulating
the future climate and vice versa), the \ac{MDER} assumption is more reasonable
and allows correcting models instead of just weighing
\commentcite{Karpechko2013}{see \cref{subsec:02:mder}}. Following other
\ac{MDER} studies \autocite{Karpechko2013, Senftleben2020, Wenzel2016a}, we
also select diagnostics as predictor variables $\bm{x}$ that are related to
\ac{GPP}-relevant processes (see \cref{tab:06:predictors} for detailed physical
explanations of the links between the predictors and \ac{GPP}).

The raw \acs{CMIP}5 and observation-driven datasets are preprocessed before
entering the \ac{ML} algorithm (see \cref{subsec:app:b:data_preprocessing}). In
particular, increases greater than $300 \unit{\%}$ in the fractional \ac{GPP}
change that is used as target variable in step 2b are removed. These
unrealistically high values (making up about $5.9 \unit{\%}$ of the data) occur
in places with very small absolute \ac{GPP} values in the historical simulation
that are used in the denominator of the derivation of the fractional \ac{GPP}
change (see \cref{eq:06:f}). In addition, we randomly select $25 \unit{\%}$ of
the training data and use it as hold-out test data. This dataset is excluded
from the training and can therefore be used for an independent validation of
our statistical model.


\subsection{Assessment of Uncertainty and Predictive Skill}
\label{subsec:06:uncertainty_and_skill}

The estimation of the \acf{SPE} for the \ac{GBRT} models needs to consider
three sources of uncertainty: the uncertainty of the \ac{ML} model itself, the
uncertainty in the rescaling of the target variable and the uncertainty in the
input data, that is, errors in the observation-based products. First, the
\ac{SPE} of the \ac{GBRT} model itself (\ie{} uncertainty in the position of
the gray surface in \namecrefs{fig:06:mlr_concept}
\labelcref{fig:06:mlr_concept}{\color{BrownRed} a} and
\labelcref{fig:06:mlr_concept}{\color{BrownRed} b}) is estimated as the
\emph{\acf{RMSEP}}, that is, the \ac{RMSE} between the predicted and true
values of the independent hold-out test dataset \autocite{Bishop2006}. This
approach is justified when the distribution of residuals is unbiased (see
\cref{subsec:app:b:residuals}), in which case the \ac{RMSEP} equals the
standard deviation of the residuals (which we interpret as error).
\Cref{fig:app:b:residuals} shows that this is approximately correct.

The \ac{SPE} of the \ac{GBRT} model can be understood as combined error due to
the internal variability of the climate system, the different model responses
within the climate model ensemble to forcing and the incomplete description of
the climate system with the limited number of variables used as input features.
Second, the uncertainty in the rescaling is simply assessed as the uncertainty
given by the emergent constraint from step 1. Finally, the uncertainty in the
observation-based data (\ie{} uncertainty in the position of the black points
in \cref{fig:06:mlr_concept}{\color{BrownRed} b}) is assessed by error
propagation. The necessary sensitivities of the target variable to the various
predictors for each grid cell/month are given by the linear coefficients $b_k$
given by the \ac{LIME} approach introduced in \cref{subsec:06:step_2}. All
sources of uncertainty are assumed independent and are combined by adding the
squared errors, yielding a single estimate of the \ac{SPE} for each grid
cell/month. Further details on the calculation of errors are given in
\cref{subsec:app:b:uncertainty}.

The predictive power of the \ac{GBRT} algorithm and its robustness is assessed
using a \emph{leave-one-model-out \ac{CV}} approach \commentcite{Elia2002,
  Karpechko2013}{see \cref{fig:06:mlr_concept}{\color{BrownRed} c} and
  \cref{subsec:02:model_weighting}}. For this, a single climate model is
removed from the multi-model ensemble and considered as being the true climate.
Our statistical model is then fitted on all remaining climate models and a
prediction for the \enquote{true} model is created. This allows a simple
evaluation of the predictive power by calculating the \ac{RMSEP}. The whole
process is repeated for every climate model of the ensemble in order to get a
distribution of \acp{RMSEP}. Since this approach is not limited to \ac{GBRT},
it allows a simple comparison of the predictive skill of different statistical
models. We compare the \ac{GBRT} model to the simple \acs{CMIP}5 \acf{MMM} and
a \ac{LASSO} model \autocite{Tibshirani1996}. The \ac{LASSO} model is an
extended linear regression model that regularizes the least squares solution
with an L$1$ penalty term. In contrast to the ordinary least squares
regression, the \ac{LASSO} model promotes sparse solutions (\ie{} only a few
non-zero coefficients/weights), which acts as an intrinsic feature selection
and provides an effective way to combat overfitting induced by collinearity.


\section{Results}
\label{sec:06:results}


\subsection{Constraining Global Mean \acs{GPP} Projections (Step 1)}
\label{subsec:06:results_step1}

In \textcite{Wenzel2016}, the observed atmospheric \ac{CO2} concentration at
\ac{KUM} \autocite{Keeling2005} is used to constrain the \ac{GPP} change in the
\ac{1BGC} run resulting from a doubling of atmospheric \ac{CO2} concentrations
to $\pmrangeunit{32}{9}{\%}$ for extratropical ecosystems
($\rangeunit{30}{90}{\degree N}$). As mentioned in \cref{subsec:06:step_1}, we
argue that due to the strong annual mixing of \ac{CO2} in the atmosphere, this
emergent constraint can also be applied to the global mean \ac{GPP} change if
the emergent relationship holds. In order to test this, we first use the
idealized \acs{CMIP}5 simulations that were analyzed by \textcite{Wenzel2016}
to calculate the emergent constraint (\cref{fig:06:step1:a}). The relationship
is statistically significant at a $5 \unit{\%}$ significance level ($R^2 =
0.79$, $p = 0.007$) and predicts a constrained global mean \acs{GPP} change of
$\pmrangeunit{30}{9}{\%}$, which is consistent with the findings of
\textcite{Wenzel2016}. This result gives us confidence that the emergent
relationship holds for the global mean \ac{GPP}. Details on the mathematical
derivation of the constrained range are given in
\cref{subsec:02:emergent_constraints}.

\begin{figure}[t]
  \centering
  \begin{subfigure}[b]{0.37\columnwidth}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/3a.pdf}
    \caption{}
    \label{fig:06:step1:a}
  \end{subfigure}
  \begin{subfigure}[b]{0.37\columnwidth}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/3b.pdf}
    \caption{}
    \label{fig:06:step1:b}
  \end{subfigure}
  \begin{subfigure}[b]{0.24\columnwidth}
    \raisebox{12.9mm}{\includegraphics[width=\columnwidth]{
      ch06_paper_gpp/figs/3c.pdf}}
  \end{subfigure}
  \caption[
    Emergent relationship between the global mean fractional change in
    \acf{GPP} and the sensitivity of the \acs{CO2} seasonal cycle amplitude to
    rising atmospheric \acs{CO2} concentrations observed at \acl{KUM}.
  ]{
    Emergent relationship between the global mean fractional change in
    \acf{GPP} and the sensitivity of the \acs{CO2} seasonal cycle amplitude to
    rising atmospheric \acs{CO2} concentrations observed at \acf{KUM}. Colored
    points refer to \acs{CMIP}5 models, the orange line and shaded area to the
    linear regression fit and its corresponding \acl{SPE}, and the dashed black
    lines to the observational constraint. (a) Similar to
    \textcite{Wenzel2016}: The global mean fractional \acs{GPP} change after
    \acs{CO2} doubling in a \acf{1BGC} defined as 10-year mean of the
    \acs{1BGC} run centered at the time of \acs{CO2} doubling relative to the
    10-year mean of pre-industrial control conditions at the beginning of the
    \acs{1BGC} run. The sensitivity of the \acs{CO2} amplitude for the
    \acs{CMIP}5 models is calculated from the years \range{1860}{2005}, the
    corresponding observational value from the years \range{1979}{2019}. The
    constrained global mean \acs{GPP} change after \acs{CO2} doubling in the
    \acs{1BGC} run is $\pmrangeunit{30}{9}{\%}$. (b) Fractional global mean
    \acs{GPP} change over the \nth{21} century calculated from the 10-year mean
    \acs{GPP} at the end of the \nth{21} century (\range{2091}{2100}) in the
    emission-driven fully-coupled \acs{RCP}8.5 simulations and the 10-year mean
    \acs{GPP} at the end of the \nth{20} century (\range{1991}{2000}) in the
    emission‐driven fully-coupled historical run (see \cref{eq:06:f}). In
    contrast to \textcite{Wenzel2016}, the sensitivity of the \acs{CO2}
    amplitude is calculated from the years \range{1979}{2019} for climate
    models and observations for better comparability (the historical
    \acs{CMIP}5 simulations are extended with the \acs{RCP}8.5 simulations for
    the years \range{2006}{2019}). The constrained global mean \acs{GPP} change
    over the \nth{21} century is $\pmrangeunit{39}{7}{\%}$.
    \AdaptedFrom{Schlund2020}.
  }
  \label{fig:06:step1}
\end{figure}

In addition to applying it to the idealized simulations, we apply the emergent
constraint to the \acs{RCP}8.5 scenario. In the \ac{1BGC} simulation, the
\ac{CO2} fertilization effect is the only driver of future \ac{GPP} change
since the carbon cycle components of the \acp{ESM} only see the increasing
\ac{CO2} concentration. However, since the magnitude of the
concentration-carbon feedback is believed to be four times the size of the
climate-carbon feedback \autocite{Gregory2009}, the \ac{CO2} fertilization
effect is still the dominant driver of \ac{GPP} change in the fully-coupled
simulations \autocite{Huntzinger2017}. This is also supported by
\textcite{Wenzel2016}, who show that the \ac{GPP} increase due to rising
atmospheric \ac{CO2} concentrations in the fully-coupled historical simulations
is proportional to the same quantity in the \ac{1BGC} run. Additional lines of
evidence suggest that the modeled \ac{CO2} sensitivity of photosynthesis is the
main source of uncertainty of future \ac{GPP} \autocite{Arora2013, Haverd2020,
  Rogers2017}. Thus, the sensitivity of the \ac{CO2} amplitude can be used to
approximately constrain global mean \ac{GPP} change over the \nth{21} century
in \acs{RCP}8.5, which is shown in \cref{fig:06:step1:b}. Assuming a
significance level of $5 \unit{\%}$, the emergent relationship is statistically
significant ($R^2 = 0.65$, $p = 0.029$).

Using the emergent relationship, the global mean \ac{GPP} change over the
\nth{21} century can be constrained to $\pmrangeunit{39}{7}{\%}$ (standard
error), which is at the lower end of the original \acs{CMIP}5 range
($\rangeunit{31}{57}{\%}$). Moreover, the best estimate $39 \unit{\%}$ is also
slightly lower than the \acs{CMIP}5 \ac{MMM} of $43 \unit{\%}$. The observed
\ac{GPP} averaged over the years \range{1991}{2000} from the FLUXNET-MTE
product is $\pmrangeunit{123}{6}{\GtCyr{}}$ \autocite{Jung2011}. Assuming
independent errors and using Gaussian error propagation, the constrained
fractional change corresponds to a global mean \ac{GPP} of
$\pmrangeunit{171}{12}{\GtCyr{}}$ (standard error) at the end of the \nth{21}
century (\range{2091}{2100}) in the \acs{RCP}8.5 scenario. In contrast to that,
the unconstrained\acs{CMIP}5 ensemble has a model range of
$\rangeunit{156}{247}{\GtCyr{}}$ for future \ac{GPP} in the \acs{RCP}8.5
scenario (\range{2091}{2100}). The resulting global mean \ac{GPP} change is
used to rescale the gridded output of the different climate models with
\cref{eq:06:y}. The following two \namecrefs{subsec:06:results_step2a} show the
results for the rescaled absolute future \ac{GPP} (step 2a) and the rescaled
fractional \ac{GPP} change (step 2b) further constrained by the \ac{GBRT}
model.


\subsection{Constraining Gridded Absolute \acs{GPP} Projections (Step 2a)}
\label{subsec:06:results_step2a}

In the second step, the objective is to constrain the spatial distribution of
the projected \ac{GPP}. We use the grid-wise monthly mean climatology of
absolute \ac{GPP} at the end of the \nth{21} century (\range{2091}{2100}) as
target variable, rescaled using \cref{eq:06:y} to reduce the large
uncertainties in the \acs{CO2} fertilization effect in the models. In the first
part, we evaluate the GBRT model using the leave-one-model-out \ac{CV} approach
and compare it to other statistical approaches and the unweighted \ac{MMM}. In
the second part, we use observation-based products to predict the target
variable.


\subsubsection{Prediction Error in Leave‐One‐Model‐Out \acs{CV} Approach and
  Feature Importance}
\label{subsubsec:06:results_step2a_ml_inference}

To get a detailed insight into the performance of our \ac{GBRT} model, we
compare it to five other statistical models: the unweighted \acs{CMIP}5
\ac{MMM} of future \ac{GPP}, its rescaled version using \cref{eq:06:y}
(r\acs{MMM}), a linear \ac{LASSO} regression model using all features as
defined in \cref{tab:06:predictors}, a single-predictor \ac{LASSO} model
(\acs{LASSO}-1D) and a single-predictor \ac{GBRT} model (\acs{GBRT}-1D). Both
single-predictor models use the historical \ac{GPP} as only feature. The
predictive power (in terms of \ac{RMSEP}) of each statistical model is assessed
using the leave-one-model-out \ac{CV} approach (see
\cref{subsec:06:uncertainty_and_skill}). This allows us to create an \ac{RMSEP}
distribution for each statistical approach, where the different points of the
distributions refer to different training/prediction dataset combinations
generated by the leave-one-model-out \ac{CV} approach. Thus, each distribution
consists of seven points, one for each climate model.
\Cref{fig:06:step2a_ml_inference:a} shows the \ac{RMSEP} distributions for the
six different statistical models.

\begin{figure}[!t]
  \centering
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \raisebox{5.5mm}{\includegraphics[width=\columnwidth]{
      ch06_paper_gpp/figs/4a.pdf}}
    \caption{}
    \label{fig:06:step2a_ml_inference:a}
  \end{subfigure}
  ~
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/4b.pdf}
    \caption{}
    \label{fig:06:step2a_ml_inference:b}
  \end{subfigure}
  \caption[
    Prediction error in a leave-one-model-out \acl{CV} setup and feature
    importance of our \acl{ML} approach to constrain projected absolute
    \acf{GPP} at the end of the \nth{21} century in step 2a.
  ]{
    (a) Box plot of the \acf{RMSEP} distributions for six different statistical
    models used to predict future absolute \acf{GPP} in step 2a using a
    leave-one-model-out \acl{CV} approach. The distribution for each
    statistical model contains seven elements (black points; one for each
    climate model used as truth) and is represented in the following way: The
    lower and upper limit of the blue boxes correspond to the $25 \unit{\%}$
    and $75 \unit{\%}$ quantiles, respectively. The central line in the box
    shows the median and the black \enquote{x} shows the mean of the
    distribution. The whiskers outside the box represent the range of the
    distribution. Compared to the \acs{CMIP}5 \acf{MMM} and its corresponding
    rescaled version (r\acs{MMM}), the prediction uncertainty measured by the
    mean \acs{RMSEP} is significantly reduced by up to $48 \unit{\%}$ and $39
    \unit{\%}$, respectively, when using other statistical models. Moreover,
    the non-linear \acf{GBRT} models can slightly reduce the mean \acs{RMSEP}
    compared to the linear \acf{LASSO} models by about $2 \unit{\%}$ for
    \acs{GBRT}-1D (using historical \acs{GPP} as single predictor) and $3
    \unit{\%}$ for the full \acs{GBRT} model (using all predictors). (b)
    Relative global feature importance for the different predictors used in the
    \acs{GBRT} model to predict future absolute \acs{GPP} (step 2a). The red
    bars correspond to positive Pearson correlation coefficients between all
    predictors and the target variable. Due to its strong positive linear
    relationship with the future \acs{GPP}, the historical \acs{GPP} is by far
    the most important predictor in the model. A local feature importance map
    using \acf{LIME} is not shown here because \acs{GPP} is the dominant
    predictor for all grid cells. \AdaptedFrom{Schlund2020}.
  }
  \label{fig:06:step2a_ml_inference}
\end{figure}

In terms of raw predictive power, the simple \ac{MMM} is outperformed by every
other model. Its prediction uncertainty expressed as mean \ac{RMSEP} can be
reduced by more than $48 \unit{\%}$ by using other statistical models. However,
this is not surprising: In contrast to the other statistical models, the simple
\acs{RCP}8.5 \ac{MMM} does not take further evidence in form of observations of
the historical climate into account. Step 1 of our algorithm (r\acs{MMM}) can
reduce this mean \ac{RMSEP} by $15 \unit{\%}$ due to the simple rescaling of
the gridded climate model output with the global mean \ac{GPP} constraint on
the \ac{CO2} fertilization effect. However, since there is a considerably large
\ac{GPP} range in the individual climate models themselves, this reduction is
rather small for the gridded values. A far larger reduction of the \ac{RMSEP}
can be achieved by using the regression models \acs{LASSO}‐1D, \ac{LASSO},
\acs{GBRT}‐1D and \ac{GBRT}. All of them share similar \ac{RMSEP}
distributions, which can be explained as follows: The historical \ac{GPP} is
strongly (near linearly) correlated to the rescaled end-of-century \ac{GPP}
(with pattern correlation of $R^2 = 0.83$ for the whole multi-model ensemble).
Because of that, all regression models are able to considerably reduce the
\acp{RMSEP} compared to the \ac{MMM} and r\acs{MMM}. This also shows that the
\ac{GBRT} models successfully learn the linear connection between past and
future \ac{GPP}. Moreover, the non-linear \ac{GBRT} models can slightly reduce
the mean \ac{RMSEP} even further compared to the linear \ac{LASSO} models by
about $2 \unit{\%}$ for \acs{GBRT}‐1D and $3 \unit{\%}$ for the full \ac{GBRT}
model. This leads to the conclusion that in addition to the strong linear
relationship between past and future \ac{GPP}, there are small non-linear
relations between the predictors and the target variable that can be used to
further reduce the \ac{RMSEP}. Since the full \ac{GBRT} model with access to
all predictors shows the minimal mean \ac{RMSEP}, we argue that it is
beneficial for our approach to use the multivariate non-linear \ac{GBRT} model
instead of a linear model because only the \ac{GBRT} algorithm is able to make
use of all predictors and exploit more complex relationships.

The influence of the different predictors can be further analyzed by evaluating
the global feature importance by using the whole training dataset and the
already trained model. This is shown in \cref{fig:06:step2a_ml_inference:b}.
The past \ac{GPP} with its strong positive linear correlation to future
\ac{GPP} is the most relevant predictor of the trained model with a relative
importance of approximately $95 \unit{\%}$. All other features show values of
less than $2 \unit{\%}$. The global feature importance determines the expected
impact of a feature in predictions of the target variable. In our \ac{GBRT}
model, the prediction input data of historical \ac{GPP} mainly determines the
\ac{ML} model's prediction of the future \ac{GPP} in the \acs{RCP}8.5 scenario
at the end of the \nth{21} century. However, we emphasize that this is only
valid for our specific setup (\ie{} which variables are used, which algorithm
is used, which climate models are considered, \etc{}). For another problem
setup, the global feature importance could change significantly. Since the
historical \ac{GPP} is the most important predictor for all grid cells, we do
not show the plot of the local feature importance using \ac{LIME}. We can get
further insights into our \ac{GBRT} model by analyzing the residuals of the
prediction using an independent test dataset. The resulting plots show that the
algorithm is not overfitting the training data and that the prediction errors
on the whole are approximately unbiased (see \cref{fig:app:b:residuals:a}).


\subsubsection{Observation-Based \acs{GBRT} Prediction of Absolute \acs{GPP}}
\label{subsubsec:06:results_step2a_obs}

In this \namecref{subsubsec:06:results_step2a_obs}, we use the different
statistical models to predict absolute \ac{GPP} at the end of the \nth{21}
century. For this, we feed observation-based data (see
\cref{tab:06:predictors}) into the regression models \ac{GBRT}, \acs{GBRT}‐1D,
\ac{LASSO} and \acs{LASSO}‐1D.

The result of step 1 on the gridded data is illustrated in
\cref{fig:06:step2a_results:a}, which shows the ratio between r\acs{MMM} and
\ac{MMM}. This ratio is almost constant over the whole globe, which is not
surprising due to the global nature of the rescaling (see \cref{eq:06:y}). The
use of the global emergent constraint predicts a slightly lower \ac{GPP}
increase over the \nth{21} century ($39 \unit{\%}$) than the unweighted
\acs{CMIP}5 ensemble mean ($43 \unit{\%}$). The corresponding ratio $39
\unit{\%} / 43 \unit{\%} \approx 0.91$ is approximately equal to the mean value
of r\acs{MMM}/\acs{MMM} ($0.92$). Consequently, the global estimate of
r\acs{MMM} gives a lower \ac{GPP} at the end of the century ($179
\unit{\GtCyr{}}$) as \ac{MMM} ($198 \unit{\GtCyr{}}$), which can be
interpreted as a correction of the \acp{ESM}' overestimation of future \ac{GPP}
to changes in the atmospheric \ac{CO2} concentration.

\begin{figure}[!t]
  \centering
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/5a.pdf}
    \caption{}
    \label{fig:06:step2a_results:a}
  \end{subfigure}
  \\
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/5b.pdf}
    \caption{}
    \label{fig:06:step2a_results:b}
  \end{subfigure}
  ~
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/5c.pdf}
    \caption{}
    \label{fig:06:step2a_results:c}
  \end{subfigure}
  \caption[
    Illustration of our \acl{ML} approach to constrain projected absolute
    \acf{GPP} at the end of the \nth{21} century with observations in step 2a.
  ]{
    (a) Ratio of the rescaled \acs{CMIP}5 ensemble mean of the absolute
    \acf{GPP} at the end of the \nth{21} century (\range{2091}{2100}) in the
    \acs{RCP}8.5 scenario using \cref{eq:06:y} (r\acs{MMM}) and its unweighted
    version (\acs{MMM}). The plot shows an almost constant value over the whole
    globe with a mean of $0.92$, which corresponds to the ratio of the
    constrained global mean \acs{GPP} change over the \nth{21} century from
    step 1 ($39 \unit{\%}$) and the \acs{CMIP}5 ensemble mean global mean
    \acs{GPP} change ($43 \unit{\%}$). All values close to $0$ for the dataset
    in the denominator have been masked to avoid divisions by $0$. (b) Bias
    between r\acs{MMM} and our \acf{GBRT} prediction for the end of the
    \nth{21} century. This corresponds to step 2a of our approach. (c) Bias
    between the modeled \acs{GPP} in the \acs{CMIP}5 \acs{MMM} of the
    historical simulation and the FLUXNET-MTE observation‐based estimate of
    \acs{GPP} \autocite{Jung2011} averaged between 1991 and 2000. Over large
    swaths of the globe, the \acs{CMIP}5 ensemble overestimates \acs{GPP} (red
    color). Panels (b) and (c) show similar bias patterns (pattern correlation
    of $R^2 = 0.88$). Thus, the \acs{GBRT} prediction in step 2a is able to
    correct the historical bias of the \acs{CMIP}5 ensemble relative to the
    FLUXNET‐MTE product. \AdaptedFrom{Schlund2020}.
  }
  \label{fig:06:step2a_results}
\end{figure}

\begin{figure}[!t]
  \centering
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/6a.pdf}
    \caption{}
    \label{fig:06:step2a_results_biases:a}
  \end{subfigure}
  ~
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/6b.pdf}
    \caption{}
    \label{fig:06:step2a_results_biases:b}
  \end{subfigure}
  \\
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/6c.pdf}
    \caption{}
    \label{fig:06:step2a_results_biases:c}
  \end{subfigure}
  ~
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/6d.pdf}
    \caption{}
    \label{fig:06:step2a_results_biases:d}
  \end{subfigure}
  \caption[
    Further illustrations of our \acl{ML} approach to constrain projected
    absolute \acf{GPP} at the end of the \nth{21} century with observations in
    step 2a and comparison to other statistical models.
  ]{
    Difference (a) and ratio (b) of the both biases shown in
    \cref{fig:06:step2a_results:b,fig:06:step2a_results:c}. For panel (b), all
    values close to $0$ for the dataset in the denominator have been masked to
    avoid divisions by $0$. Both panels show that our approach is only to first
    order a bias correction, in which case both plots would only show constant
    values. (c) Comparison of the \acf{GBRT} versus \acs{GBRT}-1D projections
    of future \acf{GPP}. This panel indicates a clear difference between the
    full \acs{GBRT} model using all predictors and the \acs{GBRT} model using
    only historical \acs{GPP} as single predictor. (d) Comparison of the
    \acs{GBRT} versus the \acf{LASSO} projections of future \acs{GPP}. This
    panel shows that there is a clear difference between using the non-linear
    \acs{GBRT} model and the linear \acs{LASSO} model. The results of the
    \acs{LASSO}-1D model are not shown here because they are very similar to
    the results of the \acs{LASSO} model. \AdaptedFrom{Schlund2020}.
  }
  \label{fig:06:step2a_results_biases}
\end{figure}

The spatial result of our \ac{GBRT} model in step 2a can be visualized by
comparing r\acs{MMM} and the output of the \acs{GBRT} model.
\Cref{fig:06:step2a_results:b} shows the bias of the rescaled \acs{CMIP}5
\acs{RCP}8.5 \ac{MMM} (r\acs{MMM}) compared to our \acs{GBRT}-predicted
\ac{GPP} at the end of the \nth{21} century (\range{2091}{2100}), while
\Cref{fig:06:step2a_results:c} shows the bias of the historical \acs{CMIP}5
\ac{MMM} compared to the observational FLUXNET-MTE product \autocite{Jung2011}
averaged for the period \range{1991}{2000}. As reported by \textcite{Anav2013},
the historical \acs{CMIP}5 ensemble mean overestimates \ac{GPP} in most
regions, leading to a global mean of $138 \unit{\GtCyr{}}$, which is larger
than the $123 \unit{\GtCyr{}}$ estimate for the FLUXNET-MTE product. Regions
where \ac{GPP} is largely overestimated are the western parts of South America,
central and southern Africa, and East Asia. On the contrary, \ac{GPP} is
underestimated in small areas of Central America and northern parts of South
America. The bias patterns in
\cref{fig:06:step2a_results:b,fig:06:step2a_results:c} are very similar
(pattern correlation of $R^2 = 0.88$), which means that the \ac{GBRT} algorithm
detects regional biases in the historical simulation and corrects them in its
future predictions. This is also illustrated in
\cref{fig:06:step2a_results_biases:b}, in which many values are close to $1$,
while only a few negative values exist. However, we emphasize that our approach
is only to first order a bias correction (\ie{} subtracting the historical bias
from the \acs{RCP}8.5 \ac{MMM}). There are clear differences between
\cref{fig:06:step2a_results:b,fig:06:step2a_results:c}, which are also
illustrated in
\cref{fig:06:step2a_results_biases:a,fig:06:step2a_results_biases:b}. A simple
bias correction would only show constant values for the whole globe, whereas
our approach applies different corrections (in sign and magnitude) for
different regions. On the global domain, our approach predicts a \ac{GPP} at
the end of the century of $169 \unit{\GtCyr{}}$, which is consistent with the
global constraint from step 1 of $\pmrangeunit{171}{12}{\GtCyr{}}$. In summary,
our approach first corrects the \acs{CMIP}5 models response to \ac{CO2} (step
1) and second corrects the historical bias of the \acp{ESM} relative to
observations (step 2a).

Further illustrations of these results including the uncertainties can be found
in \cref{fig:app:b:cmip5_hist_mte,fig:app:b:step2a_results,%
  fig:app:b:step2a_results_errors}. Analogous to the results from the
leave-one-model-out \ac{CV} approach, the uncertainties on grid cell level
are significantly reduced for the \ac{GBRT} prediction compared to the
\ac{MMM} results. These errors consider all three sources of uncertainty that
we present in \cref{subsec:06:uncertainty_and_skill} (error in the \ac{GBRT}
model, error in the rescaling and error in the observational-driven
products). In contrast to that, the error derived from the
leave-one-model-out \ac{CV} approach illustrated in
\cref{fig:06:step2a_ml_inference:a} only shows the error in the statistical
models themselves. We note that local relative errors can be very large
(especially in regions with low absolute \ac{GPP}) due to the uncertainty
calculation method: Regardless of the absolute value, the error of each grid
cell is at least $535 \unit{gC \, m^{-2} yr^{-1}}$ (estimated \ac{SPE} of the
\ac{GBRT} model using the \ac{RMSEP}), which is added to the propagated
errors of the observation-driven datasets and the error derived from the
rescaling using \cref{eq:app:b:sigma_rescaling}. The \ac{GBRT} model error is
the dominant source of uncertainty. Since the true covariance structure of
these global fields is unknown, a global (or at least regional) aggregation
of these uncertainties is not possible.

To further compare our \ac{GBRT} approach to other statistical models, we also
fed the observation-driven data into the \acs{GBRT}‐1D, \ac{LASSO}, and
\acs{LASSO}‐1D models to get a constrained projection of the \acs{RCP}8.5
\ac{GPP}. \Cref{fig:06:step2a_results_biases:c,fig:06:step2a_results_biases:d}
show the difference of the other models to the full \ac{GBRT} approach. Both
panels show values close to $0$ for most of the globe (\ie{} the differences
between the \ac{GBRT} and \acs{GBRT}‐1D/\ac{LASSO} models are small),
indicating that the bias-correcting property of our approach is also present in
the other regression models that use only the historical \ac{GPP} as single
predictors. Thus, we conclude that the bias correction of our \ac{GBRT} model
originates from the observation of the historical \ac{GPP}, which is also
supported by \cref{fig:06:step2a_ml_inference:b}, which shows historical
\ac{GPP} as by far most important feature. On the contrary, second-order
corrections originate from the observations in the remaining predictors. These
second-order corrections are also visible as the non-zero values in
\Cref{fig:06:step2a_results_biases:c,fig:06:step2a_results_biases:d}. This
indicates that using the non-linear \ac{GBRT} model with all predictors
improves the final result. Moreover, the similar patterns in both panels
demonstrate that the \acs{GBRT}‐1D model emulates the strong linear relation of
the historical \ac{GPP} to future \ac{GPP} and performs equally well as the
linear models. The global estimates of $167 \unit{\GtCyr{}}$ (\acs{GBRT}‐1D),
$163 \unit{\GtCyr{}}$ (\ac{LASSO}), and $162 \unit{\GtCyr{}}$ (\acs{LASSO}‐1D)
are all consistent with the global constraint of
$\pmrangeunit{171}{12}{\GtCyr{}}$.


\subsection{Constraining Gridded Fractional \acs{GPP} Change Projections (Step
  2b)}
\label{subsec:06:results_step2b}

In step 2b, we constrain the gridded fractional \ac{GPP} change over the
\nth{21} century (2100 versus 2000) in the emission-driven \acs{RCP}8.5
scenario (rescaled using \cref{eq:06:y}). This step is independent from step 2a
and only differs in the target variable (\ac{GPP} change instead of absolute
\ac{GPP}). The remaining setup including the predictors, the \ac{GBRT} model
itself and the datasets are similar.


\subsubsection{Prediction Error in Leave‐One‐Model‐Out \acs{CV} Approach and
  Feature Importance}
\label{subsubsec:06:results_step2b_ml_inference}

\Cref{fig:06:step2b_ml_inference:a} shows the \ac{RMSEP} distributions for four
different statistical models: the simple \acs{CMIP}5 \ac{MMM} of the fractional
\ac{GPP} change, its rescaled version using \cref{eq:06:y} (r\acs{MMM}), a
linear \ac{LASSO} regression model and the \ac{GBRT} model. Similar to step 2a,
the \ac{GBRT} approach shows the smallest mean \ac{RMSEP} values of all
statistical models. Compared to \ac{MMM} and r\acs{MMM} the mean is reduced by
$16 \unit{\%}$ and $9 \unit{\%}$, respectively. Moreover, the non-linear
\ac{GBRT} model also outperforms the linear \ac{LASSO} model (mean reduced by
$3 \unit{\%}$). In contrast to step 2a, there is not a single predictor which
heavily dominates the feature importance of the \ac{GBRT} model. Thus, using
single-predictor models (\acs{GBRT}‐1D and \acs{LASSO}‐1D) is not necessary in
step 2b. \Cref{fig:06:step2b_ml_inference:b,fig:06:step2b_ml_inference:d} show
the global feature importance for the \ac{LASSO} and \ac{GBRT} model,
respectively. Both models agree that the \acf{T} and \ac{LAI} are the two
dominant predictors with a relative importance of more than $65 \unit{\%}$. The
\ac{LASSO} model shows a relative importance of less than $10 \unit{\%}$ for
each of the remaining features, while the \ac{GBRT} model exhibits a
considerably high relative importance for \ac{GPP} with almost $20 \unit{\%}$.
All predictors are negatively correlated to the target variable (as given by
the sign of the linear Pearson correlation coefficient). That means cold areas
with a small \ac{LAI} in the historical climate show a larger \ac{GPP} change
over the \nth{21} century and vice versa. Indeed, the fertilization effect is
expected to be stronger in lower \ac{LAI} regions. To get more detailed
insights on this, observation-driven data is fed into the \ac{GBRT} model to
obtain a constrained fractional \ac{GPP} change over the \nth{21} century.

\begin{figure}[p]
  \centering
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \raisebox{5mm}{\includegraphics[width=\columnwidth]{
      ch06_paper_gpp/figs/7a.pdf}}
    \caption{}
    \label{fig:06:step2b_ml_inference:a}
  \end{subfigure}
  ~
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/7b.pdf}
    \caption{}
    \label{fig:06:step2b_ml_inference:b}
  \end{subfigure}
  \\
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \raisebox{12.5mm}{\includegraphics[width=\columnwidth]{
      ch06_paper_gpp/figs/7c.pdf}}
    \caption{}
    \label{fig:06:step2b_ml_inference:c}
  \end{subfigure}
  ~
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/7d.pdf}
    \caption{}
    \label{fig:06:step2b_ml_inference:d}
  \end{subfigure}
  \caption[
    Prediction error in a leave-one-model-out \acl{CV} setup and feature
    importance of our \acl{ML} approach to constrain the fractional change in
    \acf{GPP} over the \nth{21} century in step 2b.
  ]{
    (a) Box plot of the \acf{RMSEP} distributions for four different
    statistical models used to predict the fractional change in \acf{GPP} over
    the \nth{21} century (step 2b) using the leave‐one‐model‐out \acl{CV}
    approach. A detailed description of the representation of these
    distributions is given in \cref{fig:06:step2a_ml_inference:a}. The
    \acf{GBRT} algorithm shows the minimal mean and median \acs{RMSEP}.
    Compared to the \acs{CMIP}5 \acf{MMM}, its corresponding rescaled version
    (r\acs{MMM}), and the linear \acf{LASSO} model, the mean \acs{RMSEP} of the
    \acs{GBRT} model is reduced by more than $16 \unit{\%}$, $9 \unit{\%}$, and
    $3 \unit{\%}$, respectively. (b) Relative global feature importance for the
    different features used in the \acs{LASSO} model to predict the fractional
    \acs{GPP} change (step 2b). The feature importance for the \acs{LASSO}
    model is given by the normalized linear coefficients of the model. (c)
    Local feature importance for the \acs{GBRT} model used to predict
    fractional \acs{GPP} change (step 2b) calculated using the \acf{LIME}
    approach \autocite{Ribeiro2016} for the three dominant features \acf{T},
    \acf{LAI} and \acs{GPP}. The relative influence of these three features
    (ignoring all other features) is color-coded according to the triangle in
    the lower left corner. Over large parts of the globe, \acs{T} is the
    dominant feature. (d) Relative global feature importance for the different
    features used in the \acs{GBRT} model to predict the fractional \acs{GPP}
    change (step 2b). The blue bars for the two global feature importance plots
    (b) and (d) correspond to negative Pearson correlation coefficients between
    all predictors and the target variable. \AdaptedFrom{Schlund2020}.
  }
  \label{fig:06:step2b_ml_inference}
\end{figure}


\subsubsection{Observation-Based \acs{GBRT} Prediction of Relative \acs{GPP}}
\label{subsubsec:06:results_step2b_obs}

The global distribution of the fractional \ac{GPP} change for the different
statistical models is shown in \cref{fig:06:step2b_results}. All panels show a
\ac{GPP} increase over the \nth{21} century in the \acs{RCP}8.5 scenario for
almost all regions of the globe. Compared to the unweighted \acs{CMIP}5
\ac{MMM}, its rescaled version (r\acs{MMM}) shows a slightly lower \ac{GPP}
increase, which is consistent with the emergent constraint approach from step 1
that shows a lower global mean \ac{GPP} increase over the \nth{21} century ($39
\unit{\%}$) than the global \acs{CMIP}5 ensemble mean ($43 \unit{\%}$). This is
also illustrated in \cref{fig:06:step2b_results_biases:a}, which shows an
almost constant pattern over the whole globe with a mean of $0.91$ that is
consistent with the ratio $39 \unit{\%} / 43 \unit{\%} \approx 0.91$. Similar
to step 2a, this can be interpreted as a global correction of the \acp{ESM}'
response of future \ac{GPP} to changes in the atmospheric \ac{CO2}
concentration.

\begin{figure}[t]
  \centering
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/8a.pdf}
    \caption{}
    \label{fig:06:step2b_results:a}
  \end{subfigure}
  ~
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/8b.pdf}
    \caption{}
    \label{fig:06:step2b_results:b}
  \end{subfigure}
  \\
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/8c.pdf}
    \caption{}
    \label{fig:06:step2b_results:c}
  \end{subfigure}
  ~
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/8d.pdf}
    \caption{}
    \label{fig:06:step2b_results:d}
  \end{subfigure}
  \caption[
    Illustration of our \acl{ML} approach to constrain the fractional change in
    \acf{GPP} over the \nth{21} century with observations in step 2b.
  ]{
    Fractional change in \acf{GPP} over the \nth{21} century (2100 versus 2000)
    in the \acs{RCP}8.5 scenario for different statistical models (step 2b):
    (a) \acs{CMIP}5 \acf{MMM} of the fractional \acs{GPP} change, (b) rescaled
    \acs{CMIP}5 \acl{MMM} (r\acs{MMM}) using \cref{eq:06:y}, (c) linear
    \acf{LASSO} model and (d) \acf{GBRT} model. The geographical patterns from
    the different statistical models are very similar and show a higher
    \acs{GPP} increase in high latitudes and a lower \acs{GPP} closer to the
    equator. \AdaptedFrom{Schlund2020}.
  }
  \label{fig:06:step2b_results}
\end{figure}

\begin{figure}[!t]
  \centering
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/9a.pdf}
    \caption{}
    \label{fig:06:step2b_results_biases:a}
  \end{subfigure}
  \\
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/9b.pdf}
    \caption{}
    \label{fig:06:step2b_results_biases:b}
  \end{subfigure}
  ~
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/9c.pdf}
    \caption{}
    \label{fig:06:step2b_results_biases:c}
  \end{subfigure}
  \caption[
    Further illustrations of our \acl{ML} approach to constrain the fractional
    change in \acf{GPP} over the \nth{21} century with observations in step 2b.
  ]{
    (a) Ratio of the rescaled \acs{CMIP}5 ensemble mean of the fractional
    change in \acf{GPP} over the \nth{21} century using \cref{eq:06:y}
    (r\acs{MMM}; see \cref{fig:06:step2b_results:b}) and its unweighted version
    (\acs{MMM}; see \cref{fig:06:step2b_results:a}). The plot shows an almost
    constant value over the whole globe with a mean of $0.91$, which
    corresponds to the ratio of the constrained global mean \acs{GPP} change
    over the \nth{21} century from step 1 ($39 \unit{\%}$) and the \acs{CMIP}5
    ensemble mean global mean GPP change ($43 \unit{\%}$). All values close to
    $0$ for the dataset in the denominator have been masked to avoid divisions
    by $0$. Absolute (b) and relative (c) differences between the fractional
    \acs{GPP} change over the \nth{21} century predicted by the \acf{GBRT}
    model (see \cref{fig:06:step2b_results:d}) and r\acs{MMM} (see
    \cref{fig:06:step2b_results:b}). For panel (c), all values close to $0$ for
    the dataset in the denominator have been masked to avoid divisions by $0$.
    Both plots show a good agreement over large parts of the globe
    (corresponding to values of $0$). There are large absolute differences in
    the Sahara region and central Asia. The largest relative differences
    (except for the Sahara and Arabian Peninsula region) appear over South
    America, South Africa, the west coast of Africa, the Middle East, parts of
    Australia and western parts of the United States.
    \AdaptedFrom{Schlund2020}.
  }
  \label{fig:06:step2b_results_biases}
\end{figure}

All four patterns of \cref{fig:06:step2b_results} show very similar
geographical patterns. Obvious exceptions are the Sahara desert and the Arabian
Peninsula, which show a noisy behavior for the \aclp{MMM} (\ac{MMM} and
r\acs{MMM}) and a small \ac{GPP} increase for the two regression models
(\ac{LASSO} and \ac{GBRT}). This noise-like pattern occurs due to numerical
inconsistencies produced by very small values in the absolute historical and
future \ac{GPP} in the climate models in this region that are used to derive
the fractional \ac{GPP} change following \cref{eq:06:f}. However, due to the
small impact on the global mean \ac{GPP}, this region is negligible in our
analysis. The fractional \ac{GPP} change is not uniformly distributed over the
globe. Instead, there is a pronounced latitudinal dependency in its
geographical pattern: In high latitudes, the projected \ac{GPP} change is
larger than in regions closer to the equator. This effect is particularly
strong for the northern high latitudes and consistent with the results of
\textcite{Wenzel2016}, who find an increased \ac{GPP} change in northern
high-latitude ecosystems compared to the northern extratropics. A possible
reason for this is the extension of the growing season in high latitudes caused
by climate change connected to a \emph{greening}, which has already been
observed in the past climate through satellite measurements
\autocite{Lucht2002, Myneni1997, Zhang2020} and associated with the increase in
the \ac{CO2} seasonal cycle amplitude \autocite{Forkel2016}. This is consistent
with the feature map in \cref{fig:06:step2b_ml_inference:c}, which shows an
increased relative importance of the \ac{LAI} (a quantity directly related to
the greening) in the high-latitude regions with high \ac{GPP} changes. On the
contrary, in the tropical ecosystems the growing season already covers the
whole year. Thus, a further climate change--induced extension is not possible,
leading to a smaller fractional \ac{GPP} change in regions closer to the
equator. For most parts of the remaining globe, \ac{T} is the dominant
predictor, with some areas in northern Africa, the Middle East, India and
Australia showing an increased relative importance of the historical \ac{GPP}.
Overall, the negative correlation of the three most important features (\ac{T},
\ac{LAI}, and historical \ac{GPP}) to the target variable is well reflected in
the global pattern of the fractional \ac{GPP} change: The high latitudes with
lower \ac{T}, lower \ac{LAI} and lower historical \ac{GPP} show higher \ac{GPP}
changes, whereas regions closer to the equator with higher \ac{T}, higher
\ac{LAI} and higher historical \ac{GPP} show smaller \ac{GPP} changes. At this
point we want to emphasize that it is not possible to infer global or other
large-scale averages of the fractional \ac{GPP} change from the geographical
distributions in \cref{fig:06:step2b_results} since division operations and
averaging operations do not commute: in general, $\sum_i \left( a_i / b_i
\right) \neq \left( \sum_i a_i \right) / \left( \sum_i b_i \right)$. Thus, a
direct comparison to other studies that give locally or globally aggregated
results is not possible.

To get further insights in the \ac{GBRT} algorithm, we compare it directly to
the rescaled \acs{CMIP}5 \ac{MMM} (r\acs{MMM}), which is illustrated in
\cref{fig:06:step2b_results_biases:b,fig:06:step2b_results_biases:c}. The
mismatch between \ac{GBRT} and r\acs{MMM} can be interpreted as additional
information that is added to the target variable by the observations in the
predictors in step 2b. Overall, the absolute difference
(\cref{fig:06:step2b_results_biases:b}) is small over the whole globe,
indicating that the r\acs{MMM} and \ac{GBRT} agree in the general pattern of
the fractional \ac{GPP} change. The most striking deviation in this panel is
again the Sahara and Arabian Peninsula region, which shows the already
discussed large absolute differences. Apart from that, there is a large patch
in central Asia that shows high negative differences, that is, the \ac{GBRT}
model predicts a smaller \ac{GPP} change in this area. The relative difference
(\cref{fig:06:step2b_results_biases:c}) indicates many regions where the
\ac{GBRT} model predicts an increased \ac{GPP} change compared to r\acs{MMM},
in particular South America, South Africa, the west coast of Africa, the Middle
East, parts of Australia and western parts of the United States. However, all
these correspond to low absolute \ac{GPP} changes.
\Cref{fig:app:b:step2b_results_errors} shows the corresponding gridded
uncertainties for all four statistical models that also cover the uncertainty
in the emergent constraint and the observational uncertainty (in contrast to
\cref{fig:06:step2b_ml_inference:a}, which only covers the uncertainty in the
statistical models). Similar to step 2a, the local standard errors are large,
even for the \ac{GBRT} model (that performs better than any other statistical
model) which shows errors of at least $43.6 \unit{\%}$ for every grid cell
caused by the uncertainty in the statistical model itself.
\Cref{fig:app:b:residuals:b} illustrates the residuals for the training and
independent test datasets and shows that the \ac{GBRT} model has symmetrical
residuals and is not overfitting.


\subsection{Comparison of the Absolute and Relative \acs{GBRT} Prediction}
\label{subsec:06:comparison_step2a_step2b}

In a last step, we use the FLUXNET‐MTE observational product to constrain the
absolute \ac{GPP} increase at the end of the \nth{21} century
(\range{2091}{2100}) from the fractional \ac{GPP} change given by the \ac{GBRT}
model in step 2b. This can be directly compared to the output of step 2a and
serves as a sanity check between steps 2a and 2b. As shown by
\cref{fig:06:comparison_step2a_step2b}, both approaches show similar
geographical patterns (pattern correlation: $R^2 = 0.97$). The difference
between the two approaches is in the same order of magnitude as the difference
between the different statistical models used in step 2a (see
\cref{fig:06:step2a_results_biases:c,fig:06:step2a_results_biases:d}) and
considerably smaller than the difference between the \ac{GBRT} and r\acs{MMM}
approaches (see \cref{fig:06:step2a_results:b}). Moreover, the globally
aggregated results ($169 \unit{\GtCyr{}}$ for step 2a and $175 \unit{\GtCyr{}}$
for step 2b) are both compatible with the global value of
$\pmrangeunit{171}{12}{\GtCyr{}}$ given by the global emergent constraint in
step 1.

\begin{figure}[t]
  \centering
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/10a.pdf}
    \caption{}
    \label{fig:06:comparison_step2a_step2b:a}
  \end{subfigure}
  ~
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/10b.pdf}
    \caption{}
    \label{fig:06:comparison_step2a_step2b:b}
  \end{subfigure}
  \\
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/10c.pdf}
    \caption{}
    \label{fig:06:comparison_step2a_step2b:c}
  \end{subfigure}
  ~
  \begin{subfigure}[b]{\SubfigureWidth{}}
    \includegraphics[width=\columnwidth]{ch06_paper_gpp/figs/10d.pdf}
    \caption{}
    \label{fig:06:comparison_step2a_step2b:d}
  \end{subfigure}
  \caption[
    Comparison of our two independent approaches from step 2a and step 2b.
  ]{
    Top row: Absolute future \acf{GPP} at the end of the \nth{21} century
    (\range{2091}{2100}) calculated using step 2a (a) and step 2b (b). Both
    approaches give similar results with global averages of $169
    \unit{\GtCyr{}}$ (a) and $175 \unit{\GtCyr{}}$ (b), which are both
    consistent with the global result of step 1 of
    $\pmrangeunit{171}{12}{\GtCyr{}}$. The pattern correlation between both
    approaches is $R^2 = 0.97$. Bottom row: Absolute (c) and relative (d)
    differences between panels (a) and (b). \AdaptedFrom{Schlund2020}.
  }
  \label{fig:06:comparison_step2a_step2b}
\end{figure}


\section{Summary and Discussion}
\label{sec:06:summary_and_discussion}

In this paper, we develop a two-step approach to constrain the projected
\ac{GPP} at the end of the \nth{21} century (\range{2091}{2100}) in the
\acs{RCP}8.5 scenario. In the first step, we constrain the global mean \ac{GPP}
to $\pmrangeunit{171}{12}{\GtCyr{}}$ using a published emergent constraint
approach which we assume can also be applied to the global mean \ac{GPP} at the
end of the \nth{21} century in the \acs{RCP}8.5 scenario (see discussion in
\cref{subsec:06:step_1}). This step corresponds to the correction of the
\acp{ESM}' biases in the response of future \ac{GPP} to rising atmospheric
\ac{CO2} concentration, which is the main source of uncertainty in future
\ac{GPP} projections \autocite{Arora2013, Haverd2020, Rogers2017}. As already
discussed in \cref{subsec:06:step_1}, due to other than \ac{CO2} fertilization
drivers of the increase in the \ac{CO2} seasonal cycle amplitude
\autocite{Bastos2019, Forkel2016, Piao2018, Zhao2016} this emergent constraint
is not undisputed and can be replaced with another emergent constraint in
future studies. In the second step, a \ac{ML} approach is used to further
constrain the gridded \ac{GPP} based on process-based present-day predictors.
We consider two target variables: first (step 2a) the gridded monthly
climatologies of absolute \ac{GPP} (\range{2091}{2100}) and second (step 2b)
the gridded fractional \ac{GPP} change over the \nth{21} century (years
\range{2091}{2100} versus years \range{1991}{2000}; see \cref{eq:06:f}). Both
approaches give consistent results (see
\cref{fig:06:comparison_step2a_step2b}). The latter quantity shows an increased
\ac{GPP} change in the high latitudes compared to regions closer to the
equator, which might be attributed to an additional greening trend in the high
latitudes as supported by the feature map in
\cref{fig:06:step2b_ml_inference:c} that shows \ac{LAI} as dominant predictor
in this region. However, in the absence of a robust physical mechanism this
connection cannot be proven. For both target variables, the \ac{GBRT} algorithm
is superior to all other considered statistical models in terms of prediction
uncertainty evaluated in a leave-one-model-out \ac{CV} approach among different
statistical models. Compared to the unweighted \acs{CMIP}5 \ac{MMM} the mean
prediction error is reduced by $48 \unit{\%}$ (step 2a) and $16 \unit{\%}$
(step 2b); compared to a linear \ac{LASSO} regression model the mean prediction
error is reduced by approximately $3 \unit{\%}$ for both cases. However, local
standard errors are still large for both target variables, even for the
\ac{GBRT} model. Due to the unknown covariance structure a global aggregation
of these errors is not possible. Step 2a mainly corrects the bias of the
simulated absolute historical \ac{GPP} relative to observations
\autocite{Anav2013}. Consequently, the historical \ac{GPP} is by far the most
important predictor for future absolute \ac{GPP} (regions with high \ac{GPP} in
the past are likely to have high \ac{GPP} in the future and vice versa).
However, as we show in \cref{fig:06:step2a_results_biases}, the \ac{GBRT} model
expands this bias correction by taking more predictors than the historical
\ac{GPP} into account. A similar result is provided by step 2b:
\cref{fig:06:step2b_results_biases:b,fig:06:step2b_results_biases:c} show the
impact of the additional predictors as difference between the \acs{CMIP}5
\ac{MMM} and the \ac{GBRT} prediction of the \ac{GPP} change. In this case, the
target variable (fractional \ac{GPP} change) is already normalized with the
historical \ac{GPP}. Therefore, \ac{T} (second most important feature in step
2a) is now the most important predictor instead of historical \ac{GPP} (see
\cref{fig:06:step2b_ml_inference:d}). As shown in
\cref{fig:06:step2b_ml_inference:c}, the different features have also different
dominant regional impacts; but again, since there is no distinct physical
mechanism relating the predictors to the target variable this map requires
further analysis and needs to be treated with care.

Our \ac{GBRT} approach (step 2) is mathematically similar to \ac{MDER}
\autocite{Karpechko2013, Senftleben2020, Wenzel2016a}: We establish a
relationship between process-oriented, physically-relevant diagnostics and
future projections and then utilize this to project today's observed conditions
into the future. We emphasize that the exact nature of this relationship is
strongly dependent on the climate model ensemble considered. Although derived
empirically, we argue that this relationship can still be used to extract
further information from the climate model ensemble for two reasons: First, we
consider process-oriented variables which are physically linked to \ac{GPP},
and second, we ensure its statistical robustness. The latter is achieved by
considering gridded climatological data instead of global or regional means.
The number of points establishing the relation is dramatically increased from
about 50 points for classical emergent constraints to 237852 points (step 2a)
and 16503 (step 2b) in our approach. We validate the relationship by extensive
out-of-sample testing using a leave-one-model-out \ac{CV} approach and randomly
excluding parts of the data prior to training. Furthermore, the large number of
points in combination with the non-linear \ac{GBRT} model allows us to exploit
more information than classical emergent constraints and include non-linear
multivariate relations in the statistical model, including the information
encoded in spatial variation. The prediction phase of our approach (feeding
observation-based data into the trained \ac{GBRT} model) can be interpreted as
an implicit performance weighting: The \ac{GBRT} model creates predictions
based on today's conditions (in form of variables which are physically
connected to \ac{GPP}). However, unlike other performance weighting techniques
\autocite{Knutti2017a, Sanderson2017}, we do not assign constant weights to the
different climate models. On the contrary, since the algorithm works on grid
cell level, it is able to adapt to regional climate characteristics and thus
applies an implicit \emph{local} and \emph{climate-dependent} weighting.
Moreover, the algorithm adds another level of weighting by assigning a relative
relevance score to the different predictors. We emphasize that this is only an
implicit weighting, since it is not possible to extract specific values for the
individual weights due to the complex structure of the \ac{GBRT} model.

Yet, like emergent constraints and performance weighting techniques, our
\ac{GBRT} approach in step 2 hinges on the assumption that the climate models
reflect the real world. This is certainly only partially true, since there are
processes like \ac{CO2} fertilization, land use and land cover changes,
nutrient cycles and limitations \autocite{Du2020,Fleischer2019}, disturbances,
and induced vegetation dynamics which may strongly alter the future
trajectories of \ac{GPP} without this being fully encoded in today's
observational products. Moreover, all \ac{CO2}-related effects are only
implicitly incorporated in our approach by the target period we are using and
the global rescaling using the emergent constraint in step 1. Thus, our
reduction of uncertainty only applies to the specific setup we are considering
here: the future \ac{GPP} in the \acs{CMIP}5 \acs{RCP}8.5 scenario at the end
of the \nth{21} century. It has to be viewed as a nominal reduction, while the
real uncertainty remains unknown and is likely larger than the nominal one.
These issues could be tested in the future by including other (even offline)
models, which account for the aforementioned processes. A true validation will
only be possible once we experience the changed condition or could be based on
paleo data. In summary, our approach does not address the coupled system
directly but hinges on the climate predictions of the individual \acp{ESM} and
hence is not able to implicitly correct respective biases of the \acs{CMIP}5
ensemble.

The presented approach based on \ac{ML} is not limited to projections of the
future carbon cycle, which is used as an illustrative example. Indeed, since
its only prerequisites are the availability of gridded climate model data and
gridded observation-based data, the \ac{GBRT} algorithm can be applied to any
variable of interest if physically-relevant diagnostics that influence the
target variable are known. This opens a wide range of possibilities for
constraining uncertainties in projected variable scenarios. In addition, maps
of the local relative feature importance as shown in
\cref{fig:06:step2b_ml_inference:c} can be used to reveal connections between
different Earth system variables that are currently unknown. With the proposed
data-driven approach, a possibly extended application could be to constrain
projections of not just one but several variables simultaneously. Moreover, the
concept of our method is not limited to \ac{GBRT} but can be used with any
other (\ac{ML}) regression algorithm.
